{% sw_extends '@Storefront/storefront/component/checkout/offcanvas-cart.html.twig' %}

{% block utilities_offcanvas_close_icon %}
    {% sw_icon 'x' style { size: 'md' } %}
{% endblock %}

{% block utilities_offcanvas_close_text %}
    {{ 'checkout.cartHeader'|trans|sw_sanitize }}

    {% set isCartNotEmpty = (page.cart.lineItems|length > 0) %}
    {% set checkoutItemCounter = page.cart.lineItems|length %}

    {% block component_offcanvas_cart_header_item_counter %}
        {% if isCartNotEmpty %}
            <div class="badge rounded-pill">
                {{ checkoutItemCounter }}
            </div>
        {% endif %}
    {% endblock %}
{% endblock %}

{% block component_offcanvas_cart %}
    {% set isCartNotEmpty = (page.cart.lineItems|length > 0) %}

    {# ... @zenit - added offcanvasCartClasses to control offcanvas-cart-scroll functionality #}
    {% set offcanvasCartClasses = [] %}
    {% set offcanvasCartClasses = (page.extensions.SwagAmazonPayButton is not null or expressSettings.offCanvasEnabled) ? ['offcanvas-cart-btns']|merge(offcanvasCartClasses) : ['offcanvas-cart-scroll']|merge(offcanvasCartClasses) %}

    <div class="offcanvas-cart {{ offcanvasCartClasses|join(' ') }}">
        {{ block('component_offcanvas_cart_flashbags') }}

        {% if isCartNotEmpty %}
            {{ block('component_offcanvas_cart_items') }}
        {% else %}
            {{ block('component_offcanvas_cart_empty') }}
        {% endif %}

        {% if isCartNotEmpty %}
            {{ block('component_offcanvas_summary') }}
        {% endif %}

        {{ block('component_offcanvas_cart_actions') }}
    </div>

    {{ block('component_offcanvas_cart_hidden_line_items_information') }}
{% endblock %}

{% block component_offcanvas_cart_items %}
    {{ block('zen_offcanvas_cart_add_product') }}
    {{ parent() }}
{% endblock %}

{% block component_offcanvas_cart_empty %}
    {{ block('zen_offcanvas_cart_add_product') }}
    {{ parent() }}
{% endblock %}

{% block zen_offcanvas_cart_add_product %}
    {% if theme_config('zen-cart-product-number-input-offcanvas') is same as ('always')
    or (theme_config('zen-cart-product-number-input-offcanvas') is same as ('filled') and page.cart.lineItems is not empty) %}
        <div class="cart-add-product-container">
            <form action="{{ path('frontend.checkout.product.add-by-number') }}"
                  class="cart-add-product"
                  data-zen-add-by-number-offcanvas="true"
                  method="post">

                {% block zen_offcanvas_cart_add_product_input_group %}
                    <div class="input-group">
                        {% block zen_offcanvas_cart_add_product_label %}
                            <label class="visually-hidden" for="addProductInput">
                                {{ 'checkout.addProductLabel'|trans|sw_sanitize }}
                            </label>
                        {% endblock %}

                        {% block zen_offcanvas_cart_add_product_input %}
                            <input type="text"
                                   name="number"
                                   class="form-control"
                                   id="addProductInput"
                                   placeholder="{{ 'checkout.addProductPlaceholder'|trans|striptags }}"
                                   aria-label="{{ 'checkout.addProductLabel'|trans|striptags }}"
                                   aria-describedby="addProductButton"
                                   required="required">
                        {% endblock %}

                        {% block zen_offcanvas_cart_add_product_submit %}
                            <button class="btn btn-secondary"
                                    type="submit"
                                    id="addProductButton">
                                {% sw_icon 'checkmark' %}
                            </button>
                        {% endblock %}
                    </div>
                {% endblock %}
            </form>
        </div>
    {% endif %}
{% endblock %}
